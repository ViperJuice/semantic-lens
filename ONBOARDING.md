# Codebase Onboarding Guide

> Auto-generated by `/ai-dev-kit:quickstart-codebase` on 2026-01-02
>
> **Control Plane**: Claude Code (ai-dev-kit plugin) orchestrates workflows.
> For specialized tasks, delegate via `/ai-dev-kit:delegate <provider> "<task>"`.

---

## Project Overview

**Semantic Lens** is a semantic code graph visualization platform for understanding large codebases. It processes codebase data from external chunkers/analyzers, stores it in a graph database, detects design patterns using declarative rules, and renders interactive architectural diagrams.

**Status**: Active development - Phases 1-6 complete with 610 passing tests

---

## Technology Stack

### Languages
| Language   | Version | Role    |
|------------|---------|---------|
| TypeScript | 5.3.x   | Primary |

### Frameworks & Libraries
| Name        | Version | Category                    |
|-------------|---------|------------------------------|
| Express     | 4.18.x  | HTTP API Server              |
| Cytoscape   | 3.33.x  | Graph Visualization          |
| ELK (elkjs) | 0.9.x   | Deterministic Graph Layout   |
| AJV         | 8.12.x  | JSON Schema Validation       |
| yaml        | 2.8.x   | YAML Parsing (Pattern DSL)   |
| cors        | 2.8.x   | CORS middleware              |

### Test Frameworks
| Name   | Version | Purpose              |
|--------|---------|----------------------|
| Vitest | 1.0.x   | Unit & E2E Testing   |

### Build Tools
| Tool       | Version | Purpose                |
|------------|---------|------------------------|
| TypeScript | 5.3.x   | Compilation            |
| ESLint     | 8.55.x  | Linting                |
| Prettier   | 3.1.x   | Code Formatting        |

### Infrastructure (Optional)
| Component      | Technology     | Purpose               |
|----------------|----------------|------------------------|
| Graph Database | Memgraph/Neo4j | Cypher pattern queries |
| In-Memory      | Built-in       | No-DB fallback         |

---

## Coding Standards

### Formatting (`.prettierrc`)
- **Semicolons**: Required
- **Quotes**: Single quotes
- **Tab Width**: 2 spaces
- **Trailing Commas**: ES5
- **Print Width**: 100 characters
- **Arrow Parens**: Always
- **End of Line**: LF

### Linting (`.eslintrc.cjs`)
- TypeScript strict mode enabled
- No explicit `any` (enforced)
- Prefer nullish coalescing (`??`)
- Prefer optional chaining (`?.`)
- Unused variables must start with `_`
- No console.log (warnings allowed for `warn`/`error`)

### TypeScript (`tsconfig.json`)
- **Target**: ES2022
- **Module**: NodeNext
- **Strict Mode**: Enabled
- **noImplicitReturns**: Enabled
- **noFallthroughCasesInSwitch**: Enabled
- **noUncheckedIndexedAccess**: Enabled

### Commit Conventions
- Format: `type(scope): description`
- Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

---

## Documentation Sources

### Available Locally
- `docs/README.md` - User documentation
- `docs/api.md` - API reference
- `specs/ROADMAP.md` - Full implementation roadmap
- `specs/plain_english_spec.md` - Technical specification with JSON Schema
- `.claude/architecture/CODEBASE.md` - C4 architecture diagrams
- `.claude/architecture/TECH-DEBT.md` - Technical debt inventory

### Recommended to Add
```bash
# No additional documentation sources required - project is well-documented
```

---

## Architecture Overview

### System Context (C4 Level 1)

```
                                    +------------------+
                                    |    Developer     |
                                    +--------+---------+
                                             |
                                    +--------v---------+
                                    | Semantic Lens    |
                                    +--------+---------+
                                             |
              +------------------------------+------------------------------+
              |                              |                              |
     +--------v---------+           +--------v---------+           +--------v---------+
     |  Code Chunker    |           |   LSP Server     |           |  Code Repository |
     |  (External)      |           |   (External)     |           |  (External)      |
     +------------------+           +------------------+           +------------------+
```

### Container Diagram (C4 Level 2)

| Container        | Technology    | Responsibility                                |
|------------------|---------------|-----------------------------------------------|
| Visualization UI | Cytoscape.js  | Interactive graph display, user interactions  |
| View Service     | Express.js    | Graph projection, ELK integration, API        |
| Pattern Engine   | TypeScript    | Pattern DSL compilation, detection            |
| Graph Store      | In-Memory/Neo4j | Node/edge storage, queries                 |
| Schema Validator | AJV           | Validate SemanticGraphBundle payloads         |

### Directory Structure
```
semantic-lens/
├── src/
│   ├── schema/          # JSON Schema and validation (Phase 1)
│   ├── graph/           # Graph storage and queries (Phase 2)
│   ├── patterns/        # Pattern DSL and matching (Phase 3)
│   │   ├── dsl/         # YAML parser
│   │   ├── cypher/      # Cypher compiler
│   │   └── matcher/     # In-memory matcher
│   ├── view-service/    # HTTP API and projections (Phase 4)
│   │   ├── api/         # Express server
│   │   ├── projector/   # Subgraph extraction
│   │   ├── layout/      # ELK integration
│   │   └── formatter/   # Cytoscape output
│   ├── ui/              # Visualization (Phase 5)
│   │   ├── graph/       # Cytoscape wrapper
│   │   ├── controls/    # Lenses, filters
│   │   └── overlays/    # Pattern highlighting
│   └── cli/             # CLI commands (Phase 6)
├── tests/
│   ├── unit/            # Unit tests (610 tests)
│   └── e2e/             # End-to-end tests
├── fixtures/            # Test data
├── specs/               # Specifications and roadmap
├── plans/               # Phase execution plans (P1-P6)
└── docs/                # User documentation
```

### Key Entry Points
| Entry Point           | File                          | Purpose                |
|-----------------------|-------------------------------|------------------------|
| CLI                   | `src/cli/index.ts`            | Command-line interface |
| View Service          | `src/view-service/api/server.ts` | HTTP API server     |
| Schema Validation     | `src/schema/validator.ts`     | Bundle validation      |
| Pattern Detection     | `src/patterns/matcher/matcher.ts` | Pattern matching   |

---

## Quick Start

### Prerequisites
```bash
# Node.js 18+ required
node --version  # v18.0.0+
npm --version
```

### Development Setup
```bash
# Clone and install
cd semantic-lens
npm install

# Build the project
npm run build
```

### Running Tests
```bash
# Run all tests
npm test

# Run with coverage
npm run test:coverage

# Run E2E tests
npm run test:e2e

# Watch mode
npm run test:watch
```

### Development Server
```bash
# Start the visualization server
npm run build && node dist/cli/index.js serve --port 3000

# Or use the CLI directly
npx semantic-lens serve --port 3000 --bundle fixtures/valid-bundle.json
```

### Validation
```bash
# Validate a SemanticGraphBundle
npx semantic-lens validate fixtures/valid-bundle.json
```

### Code Quality
```bash
# Run linter
npm run lint

# Format code
npm run format
```

---

## Current Project Status

### Implementation Progress
| Phase | Name           | Status     | Tests |
|-------|----------------|------------|-------|
| 1     | Foundation     | Complete   | Pass  |
| 2     | Graph Core     | Complete   | Pass  |
| 3     | Pattern Engine | Complete   | Pass  |
| 4     | View Service   | Complete   | Pass  |
| 5     | Visualization  | Complete   | Pass  |
| 6     | Integration    | Complete   | Pass  |

### Test Summary
- **Total Tests**: 610 passed, 1 skipped
- **Test Files**: 34
- **Coverage**: Full suite passing

### Known Issues
| Issue | Description | Priority |
|-------|-------------|----------|
| 001   | Tree-sitter language pack fallback needed | Medium |

### Lint Status
- **Errors**: 143 (mostly `@typescript-eslint/no-explicit-any`)
- **Warnings**: 44
- **Action**: Run `npm run lint -- --fix` for auto-fixable issues

---

## Next Steps

### Immediate Actions
1. **Fix lint errors** - Address 143 lint errors for code quality
   ```bash
   npm run lint -- --fix
   ```

2. **Add tree-sitter fallback** - See `.claude/issues/001-tree-sitter-language-pack-fallback.md`

3. **Review retrospectives** - Check `.claude/retrospectives/` for phase learnings

### Future Enhancements
- Add GitHub remote and CI/CD pipeline
- Publish to npm registry
- Add Playwright browser tests for UI
- Consider WebSocket for real-time updates

---

## Work Manifest

### Specifications
| File | Description |
|------|-------------|
| `specs/plain_english_spec.md` | Full technical spec with JSON Schema, Cypher queries, DSL examples |
| `specs/ROADMAP.md` | 6-phase implementation roadmap |

### Phase Plans
| File | Phase | Status |
|------|-------|--------|
| `plans/P1-foundation.md` | Foundation | Complete |
| `plans/P2-graph-core.md` | Graph Core | Complete |
| `plans/P3-pattern-engine.md` | Pattern Engine | Complete |
| `plans/P4-view-service.md` | View Service | Complete |
| `plans/P5-visualization.md` | Visualization | Complete |
| `plans/P6-integration.md` | Integration | Complete |

### Open Issues
| ID | Title | Priority |
|----|-------|----------|
| 001 | Tree-sitter language pack fallback | Medium |

### Architecture Docs
| File | Description |
|------|-------------|
| `.claude/architecture/CODEBASE.md` | Full C4 architecture documentation |
| `.claude/architecture/TECH-DEBT.md` | Technical debt tracking |

### Retrospectives
| File | Phase |
|------|-------|
| `P1-20260101-201606.md` | Phase 1 retrospective |
| `P2-graph-core-retrospective.md` | Phase 2 retrospective |
| `P5-visualization-retrospective.md` | Phase 5 retrospective |
| `P6-integration-retrospective.md` | Phase 6 retrospective |

---

## Useful Commands

### ai-dev-kit Commands
```bash
# Execute a phase plan
/ai-dev-kit:execute-phase plans/P1-foundation.md

# Execute a specific lane
/ai-dev-kit:execute-lane plans/P1-foundation.md SL-SETUP

# Plan a new phase
/ai-dev-kit:plan-phase specs/ROADMAP.md "Phase N"

# Find documentation
/ai-dev-kit:docs-find cytoscape

# Delegate to other agents
/ai-dev-kit:delegate gemini "Analyze large bundle file"
/ai-dev-kit:delegate cursor "Fix lint errors"
```

### CLI Reference
```bash
semantic-lens validate <bundle.json>
semantic-lens load <bundle.json> [--db <uri>] [--clear]
semantic-lens patterns [--bundle <file>] [--output <file>]
semantic-lens serve [--port <port>] [--bundle <file>]
semantic-lens export <config.json> [--format json] [--output <file>]
```

---

_Generated by `/ai-dev-kit:quickstart-codebase` from semantic-lens project_
